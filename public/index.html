<!-- public/index.html -->
<link rel="stylesheet" href="https://unpkg.com/xterm/css/xterm.css" />
<script src="https://unpkg.com/xterm/lib/xterm.js"></script>
<script src="https://unpkg.com/socket.io/client-dist/socket.io.js"></script>

<div id="terminal-container" style="width:100%; height:100%;"></div>
<script>
  const socket = io();
  const term   = new Terminal({ cols: 80, rows: 24 });
  term.open(document.getElementById('terminal-container'));

  const PROMPT = '$ ';
  let buffer = '';

  // print initial prompt
  term.write(PROMPT);

  term.onKey(e => {
    const key = e.key;
    switch (key) {
      case '\r':   // Enter
        term.write('\r\n');
        const cmd = buffer.trim();
        socket.emit('command', cmd);
        buffer = '';
        break;
      case '\u007F': // Backspace
        if (buffer.length > 0) {
          buffer = buffer.slice(0, -1);
          term.write('\b \b');
        }
        break;
      default:
        buffer += key;
        term.write(key);
    }
  });

  // anything the server sends just gets printed
  socket.on('stdout', data => term.write(data));
  socket.on('stderr', data => term.write(data));

  // after each command finishes, server sends a 'prompt'
  socket.on('prompt', () => term.write(PROMPT));
</script>
